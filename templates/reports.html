<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reports & Analytics - Talazo AgriFinance</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
  </head>
  <body>
    <div class="container">
      <header class="page-header">
        <div class="header-content">
          <div class="header-left">
            <a href="/dashboard" class="back-link">
              <i class="fas fa-arrow-left"></i>
              Back to Dashboard
            </a>
            <h1><i class="fas fa-chart-bar"></i> Reports & Analytics</h1>
            <p>
              Comprehensive financial and agricultural performance analytics
            </p>
          </div>
          <div class="header-actions">
            <button class="btn btn-primary">
              <i class="fas fa-download"></i> Export Report
            </button>
          </div>
        </div>
      </header>

      <main class="main-content">
        <div class="stats-overview">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
              <h3>156</h3>
              <p>Total Farmers</p>
              <span class="trend positive">+12% this month</span>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-hand-holding-usd"></i>
            </div>
            <div class="stat-content">
              <h3>$2.4M</h3>
              <p>Loans Disbursed</p>
              <span class="trend positive">+18% this month</span>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-shield-alt"></i>
            </div>
            <div class="stat-content">
              <h3>89</h3>
              <p>Active Policies</p>
              <span class="trend positive">+5% this month</span>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-percentage"></i>
            </div>
            <div class="stat-content">
              <h3>96.8%</h3>
              <p>Repayment Rate</p>
              <span class="trend stable">Stable</span>
            </div>
          </div>
        </div>

        <div class="reports-grid">
          <div class="report-card">
            <h3><i class="fas fa-chart-line"></i> Loan Performance</h3>
            <div id="loan-performance-chart" style="height: 300px"></div>
          </div>
          <div class="report-card">
            <h3><i class="fas fa-seedling"></i> Crop Distribution</h3>
            <div id="crop-distribution-chart" style="height: 300px"></div>
          </div>
          <div class="report-card">
            <h3><i class="fas fa-map-marker-alt"></i> Regional Analysis</h3>
            <div id="regional-chart" style="height: 300px"></div>
          </div>
          <div class="report-card">
            <h3><i class="fas fa-calendar-alt"></i> Monthly Trends</h3>
            <div id="monthly-trends-chart" style="height: 300px"></div>
          </div>
        </div>
      </main>
    </div>

    <script>
      // Initialize charts
      document.addEventListener("DOMContentLoaded", function () {
        createLoanPerformanceChart();
        createCropDistributionChart();
        createRegionalChart();
        createMonthlyTrendsChart();
      });

      function createLoanPerformanceChart() {
        const data = [
          {
            x: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
            y: [85000, 92000, 78000, 105000, 115000, 128000],
            type: "scatter",
            mode: "lines+markers",
            name: "Loans Disbursed",
            line: { color: "#2d7d32", width: 3 },
          },
        ];

        const layout = {
          title: "Monthly Loan Disbursements",
          xaxis: { title: "Month" },
          yaxis: { title: "Amount ($)" },
          margin: { t: 50, b: 50, l: 80, r: 20 },
        };

        Plotly.newPlot("loan-performance-chart", data, layout, {
          responsive: true,
        });
      }

      function createCropDistributionChart() {
        const data = [
          {
            values: [45, 25, 15, 10, 5],
            labels: ["Maize", "Tobacco", "Soybeans", "Cotton", "Other"],
            type: "pie",
            marker: {
              colors: ["#2d7d32", "#4caf50", "#66bb6a", "#81c784", "#a5d6a7"],
            },
          },
        ];

        const layout = {
          title: "Primary Crop Distribution",
          margin: { t: 50, b: 20, l: 20, r: 20 },
        };

        Plotly.newPlot("crop-distribution-chart", data, layout, {
          responsive: true,
        });
      }

      function createRegionalChart() {
        const data = [
          {
            x: ["Harare", "Bulawayo", "Manicaland", "Mashonaland", "Masvingo"],
            y: [45, 32, 28, 38, 22],
            type: "bar",
            marker: { color: "#2d7d32" },
          },
        ];

        const layout = {
          title: "Farmers by Province",
          xaxis: { title: "Province" },
          yaxis: { title: "Number of Farmers" },
          margin: { t: 50, b: 80, l: 60, r: 20 },
        };

        Plotly.newPlot("regional-chart", data, layout, { responsive: true });
      }

      function createMonthlyTrendsChart() {
        const trace1 = {
          x: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
          y: [12, 15, 18, 22, 28, 35],
          type: "scatter",
          mode: "lines+markers",
          name: "New Farmers",
          line: { color: "#2d7d32" },
        };

        const trace2 = {
          x: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
          y: [8, 12, 15, 18, 23, 25],
          type: "scatter",
          mode: "lines+markers",
          name: "Loan Applications",
          line: { color: "#ff8f00" },
        };

        const layout = {
          title: "Monthly Growth Trends",
          xaxis: { title: "Month" },
          yaxis: { title: "Count" },
          margin: { t: 50, b: 50, l: 60, r: 20 },
        };

        Plotly.newPlot("monthly-trends-chart", [trace1, trace2], layout, {
          responsive: true,
        });
      }
    </script>
  </body>
</html>
