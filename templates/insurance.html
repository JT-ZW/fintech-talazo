<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Insurance Management - Talazo AgriFinance</title>
    <meta
      name="description"
      content="Soil-based insurance premium calculator and management for Zimbabwean farmers"
    />

    <!-- External Libraries -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.js"></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.css"
    />

    <style>
      /* Talazo AgriFinance - Insurance Management Professional Styling */

      :root {
        /* Color Palette - Professional Financial Institution */
        --primary-color: #2d7d32; /* Forest Green */
        --primary-light: #4caf50; /* Light Green */
        --primary-dark: #1b5e20; /* Dark Green */
        --secondary-color: #ff8f00; /* Amber */
        --secondary-light: #ffb74d; /* Light Amber */
        --accent-color: #795548; /* Brown */
        --accent-light: #a1887f; /* Light Brown */

        /* Neutral Colors */
        --white: #ffffff;
        --off-white: #fafafa;
        --light-gray: #f5f5f5;
        --gray: #9e9e9e;
        --dark-gray: #424242;
        --charcoal: #212121;

        /* Financial Status Colors */
        --success: #4caf50;
        --warning: #ff9800;
        --error: #f44336;
        --info: #2196f3;
        --excellent: #0d7377;
        --good: #14a085;
        --fair: #f39c12;
        --poor: #e74c3c;

        /* Typography */
        --font-primary: "Inter", sans-serif;
        --font-display: "Playfair Display", serif;

        /* Spacing */
        --spacing-xs: 0.5rem;
        --spacing-sm: 1rem;
        --spacing-md: 1.5rem;
        --spacing-lg: 2rem;
        --spacing-xl: 3rem;
        --spacing-xxl: 4rem;

        /* Border Radius */
        --radius-sm: 6px;
        --radius-md: 10px;
        --radius-lg: 16px;
        --radius-xl: 24px;

        /* Shadows */
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.12);
        --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.15);
        --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.2);

        /* Transitions */
        --transition-fast: 0.2s ease;
        --transition-normal: 0.3s ease;
        --transition-slow: 0.5s ease;
      }

      /* Reset and Base Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-primary);
        background: linear-gradient(
          135deg,
          #f8fffe 0%,
          #e8f5e8 50%,
          #f0f8f0 100%
        );
        color: var(--charcoal);
        line-height: 1.6;
        min-height: 100vh;
        padding-left: 280px; /* Account for sidebar */
        transition: padding-left var(--transition-normal);
        overflow-x: hidden;
      }

      body.sidebar-collapsed {
        padding-left: 80px;
      }

      body.mobile {
        padding-left: 0;
      }

      /* Sidebar Styles - Matching Dashboard */
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 280px;
        height: 100vh;
        background: linear-gradient(180deg, var(--charcoal) 0%, #1a1a1a 100%);
        color: var(--white);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        transition: var(--transition-normal);
        box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .sidebar.collapsed {
        width: 80px;
      }

      .sidebar-header {
        padding: var(--spacing-lg);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: space-between;
        min-height: 70px;
      }

      .sidebar-logo {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        transition: var(--transition-normal);
      }

      .sidebar-logo .logo-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--white);
        font-size: 1.25rem;
        box-shadow: var(--shadow-md);
        flex-shrink: 0;
      }

      .logo-text {
        font-family: var(--font-display);
        font-size: 1.25rem;
        font-weight: 600;
        white-space: nowrap;
        opacity: 1;
        transition: var(--transition-normal);
      }

      .sidebar.collapsed .logo-text {
        opacity: 0;
        width: 0;
      }

      .sidebar-toggle {
        background: none;
        border: none;
        color: var(--white);
        font-size: 1.25rem;
        cursor: pointer;
        padding: var(--spacing-sm);
        border-radius: var(--radius-md);
        transition: var(--transition-fast);
        opacity: 1;
      }

      .sidebar-toggle:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .sidebar.collapsed .sidebar-toggle {
        opacity: 0;
        pointer-events: none;
      }

      .sidebar-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        overflow-x: hidden;
      }

      .user-profile {
        padding: var(--spacing-lg);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        transition: var(--transition-normal);
      }

      .profile-avatar {
        font-size: 2.5rem;
        color: var(--primary-light);
        flex-shrink: 0;
      }

      .profile-info {
        opacity: 1;
        transition: var(--transition-normal);
      }

      .sidebar.collapsed .profile-info {
        opacity: 0;
        width: 0;
      }

      .profile-name {
        font-weight: 600;
        font-size: 1rem;
        color: var(--white);
        margin-bottom: var(--spacing-xs);
      }

      .profile-role {
        font-size: 0.875rem;
        color: rgba(255, 255, 255, 0.7);
      }

      .nav-menu {
        list-style: none;
        padding: var(--spacing-lg) 0;
        margin: 0;
        flex: 1;
      }

      .nav-item {
        margin-bottom: var(--spacing-xs);
        position: relative;
      }

      .nav-item.active .nav-link {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        color: var(--white);
        box-shadow: var(--shadow-md);
      }

      .nav-item.active .nav-indicator {
        opacity: 1;
        transform: scaleY(1);
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-md) var(--spacing-lg);
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        transition: var(--transition-fast);
        border-radius: 0 25px 25px 0;
        margin-right: var(--spacing-md);
        position: relative;
        overflow: hidden;
      }

      .nav-link:hover {
        background: rgba(255, 255, 255, 0.1);
        color: var(--white);
        transform: translateX(5px);
      }

      .nav-link i {
        font-size: 1.25rem;
        width: 24px;
        text-align: center;
        flex-shrink: 0;
      }

      .nav-text {
        font-weight: 500;
        white-space: nowrap;
        opacity: 1;
        transition: var(--transition-normal);
      }

      .sidebar.collapsed .nav-text {
        opacity: 0;
        width: 0;
      }

      .nav-badge {
        background: var(--primary-color);
        color: var(--white);
        font-size: 0.75rem;
        padding: 2px 6px;
        border-radius: var(--radius-sm);
        min-width: 20px;
        text-align: center;
        margin-left: auto;
        opacity: 1;
        transition: var(--transition-normal);
      }

      .sidebar.collapsed .nav-badge {
        opacity: 0;
        width: 0;
      }

      .nav-indicator {
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%) scaleY(0);
        width: 4px;
        height: 100%;
        background: var(--primary-light);
        border-radius: 0 2px 2px 0;
        transition: var(--transition-fast);
        opacity: 0;
      }

      .nav-divider {
        height: 1px;
        background: rgba(255, 255, 255, 0.1);
        margin: var(--spacing-md) var(--spacing-lg);
      }

      .nav-section {
        padding: var(--spacing-md) var(--spacing-lg) var(--spacing-sm);
      }

      .nav-section-title {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.5);
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 600;
        opacity: 1;
        transition: var(--transition-normal);
      }

      .sidebar.collapsed .nav-section-title {
        opacity: 0;
      }

      .sidebar-footer {
        padding: var(--spacing-lg);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .quick-actions {
        display: flex;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-md);
        justify-content: space-between;
      }

      .quick-action {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: var(--white);
        width: 40px;
        height: 40px;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .quick-action:hover {
        background: var(--primary-color);
        transform: translateY(-2px);
      }

      .logout-btn {
        width: 100%;
        background: none;
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.8);
        padding: var(--spacing-md);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: var(--transition-fast);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        justify-content: center;
      }

      .logout-btn:hover {
        background: rgba(244, 67, 54, 0.2);
        border-color: var(--error);
        color: var(--white);
      }

      .sidebar.collapsed .logout-btn .nav-text {
        opacity: 0;
        width: 0;
      }

      /* Mobile Overlay */
      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: var(--transition-normal);
      }

      .sidebar-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      /* Header */
      .header {
        background: var(--white);
        box-shadow: var(--shadow-sm);
        border-bottom: 1px solid rgba(45, 125, 50, 0.1);
        position: sticky;
        top: 0;
        z-index: 900;
        transition: var(--transition-normal);
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-md) var(--spacing-xl);
        gap: var(--spacing-lg);
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: var(--spacing-lg);
        flex: 1;
      }

      .mobile-menu-toggle {
        display: none;
        background: none;
        border: none;
        font-size: 1.25rem;
        color: var(--charcoal);
        cursor: pointer;
        padding: var(--spacing-sm);
        border-radius: var(--radius-md);
        transition: var(--transition-fast);
      }

      .mobile-menu-toggle:hover {
        background: var(--light-gray);
      }

      .page-header {
        flex: 1;
      }

      .page-title {
        font-family: var(--font-display);
        font-size: 2rem;
        font-weight: 600;
        color: var(--charcoal);
        margin-bottom: var(--spacing-xs);
      }

      .page-subtitle {
        color: var(--gray);
        font-size: 1rem;
        font-weight: 500;
      }

      .breadcrumb {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        color: var(--gray);
        font-size: 0.875rem;
        font-weight: 500;
        margin-bottom: var(--spacing-sm);
      }

      .breadcrumb i {
        color: var(--primary-color);
      }

      .breadcrumb .fas.fa-chevron-right {
        font-size: 0.75rem;
        color: var(--gray);
      }

      .header-actions {
        display: flex;
        gap: var(--spacing-md);
        align-items: center;
        flex-wrap: wrap;
      }

      .farmer-selector {
        padding: var(--spacing-sm) var(--spacing-md);
        border: 2px solid rgba(45, 125, 50, 0.2);
        border-radius: var(--radius-md);
        background: var(--white);
        color: var(--charcoal);
        font-family: var(--font-primary);
        font-weight: 500;
        transition: var(--transition-fast);
        min-width: 200px;
      }

      .farmer-selector:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(45, 125, 50, 0.1);
      }

      /* Container */
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--spacing-lg);
      }

      /* Stats Overview */
      .stats-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
      }

      .stat-card {
        background: var(--white);
        border-radius: var(--radius-xl);
        padding: var(--spacing-lg);
        box-shadow: var(--shadow-md);
        border: 1px solid rgba(45, 125, 50, 0.1);
        transition: var(--transition-normal);
        position: relative;
        overflow: hidden;
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--primary-light)
        );
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
      }

      .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--spacing-md);
      }

      .stat-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--white);
        font-size: 1.25rem;
        box-shadow: var(--shadow-md);
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--charcoal);
        line-height: 1;
        margin-bottom: var(--spacing-xs);
      }

      .stat-label {
        color: var(--gray);
        font-weight: 500;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .stat-trend {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        margin-top: var(--spacing-sm);
        font-size: 0.875rem;
        font-weight: 500;
      }

      .trend-up {
        color: var(--success);
      }

      .trend-down {
        color: var(--error);
      }

      /* Main Grid Layout */
      .insurance-grid {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: var(--spacing-xl);
        margin-bottom: var(--spacing-xl);
      }

      .insurance-main {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-xl);
      }

      .insurance-sidebar {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-xl);
      }

      /* Card Styles */
      .card {
        background: var(--white);
        border-radius: var(--radius-xl);
        padding: var(--spacing-xl);
        box-shadow: var(--shadow-md);
        border: 1px solid rgba(45, 125, 50, 0.1);
        transition: var(--transition-normal);
      }

      .card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .card-title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: var(--spacing-lg);
      }

      .card-title h2 {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        font-family: var(--font-display);
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--charcoal);
      }

      .card-title i {
        color: var(--primary-color);
      }

      .card-actions {
        display: flex;
        gap: var(--spacing-sm);
      }

      /* Form Styles */
      .form-section {
        margin-bottom: var(--spacing-xl);
      }

      .grid-inputs {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group label {
        font-weight: 600;
        color: var(--charcoal);
        margin-bottom: var(--spacing-sm);
        font-size: 0.875rem;
      }

      .form-group input,
      .form-group select {
        padding: var(--spacing-md);
        border: 2px solid rgba(45, 125, 50, 0.2);
        border-radius: var(--radius-md);
        background: var(--white);
        color: var(--charcoal);
        font-family: var(--font-primary);
        font-weight: 500;
        transition: var(--transition-fast);
        font-size: 1rem;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(45, 125, 50, 0.1);
      }

      .param-range {
        font-size: 0.75rem;
        color: var(--gray);
        margin-top: var(--spacing-xs);
        font-style: italic;
      }

      /* Buttons */
      .btn {
        padding: var(--spacing-md) var(--spacing-lg);
        border: none;
        border-radius: var(--radius-md);
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition-fast);
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-sm);
        text-decoration: none;
        font-family: var(--font-primary);
        white-space: nowrap;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        color: var(--white);
        box-shadow: var(--shadow-sm);
      }

      .btn-primary:hover {
        background: linear-gradient(
          135deg,
          var(--primary-dark),
          var(--primary-color)
        );
        box-shadow: var(--shadow-md);
        transform: translateY(-1px);
      }

      .btn-secondary {
        background: var(--light-gray);
        color: var(--charcoal);
        border: 1px solid rgba(45, 125, 50, 0.2);
      }

      .btn-secondary:hover {
        background: var(--gray);
        color: var(--white);
      }

      .form-actions {
        display: flex;
        justify-content: center;
        gap: var(--spacing-md);
      }

      /* Results Display */
      .results-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-xl);
        margin-bottom: var(--spacing-xl);
      }

      .soil-health-gauge {
        text-align: center;
      }

      .soil-health-gauge h3 {
        font-family: var(--font-display);
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--charcoal);
        margin-bottom: var(--spacing-lg);
      }

      .gauge-container {
        position: relative;
        margin-bottom: var(--spacing-lg);
      }

      .gauge-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--charcoal);
        margin-bottom: var(--spacing-sm);
      }

      .gauge-value .unit {
        font-size: 1rem;
        color: var(--gray);
        font-weight: 500;
      }

      .premium-details h3 {
        font-family: var(--font-display);
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--charcoal);
        margin-bottom: var(--spacing-lg);
      }

      .premium-amount {
        text-align: center;
        margin-bottom: var(--spacing-lg);
      }

      .amount {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: var(--spacing-sm);
      }

      .amount .unit {
        font-size: 1rem;
        color: var(--gray);
        font-weight: 500;
      }

      .risk-level {
        font-size: 1rem;
        font-weight: 600;
        color: var(--gray);
      }

      .coverage-details {
        background: linear-gradient(
          135deg,
          var(--light-gray) 0%,
          var(--white) 100%
        );
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        border: 1px solid rgba(45, 125, 50, 0.1);
      }

      .coverage-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-sm);
        font-weight: 500;
      }

      .coverage-item:last-child {
        margin-bottom: 0;
        padding-top: var(--spacing-sm);
        border-top: 1px solid rgba(45, 125, 50, 0.1);
      }

      .coverage-item .label {
        color: var(--gray);
      }

      .coverage-item .value {
        color: var(--charcoal);
        font-weight: 600;
      }

      /* Premium Factors */
      .premium-factors {
        margin-bottom: var(--spacing-xl);
      }

      .premium-factors h3 {
        font-family: var(--font-display);
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--charcoal);
        margin-bottom: var(--spacing-lg);
      }

      .chart-container {
        height: 300px;
        margin-bottom: var(--spacing-lg);
      }

      /* Comparison */
      .comparison-container {
        background: linear-gradient(
          135deg,
          var(--light-gray) 0%,
          var(--white) 100%
        );
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        border: 1px solid rgba(45, 125, 50, 0.1);
      }

      .comparison-container h3 {
        font-family: var(--font-display);
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--charcoal);
        margin-bottom: var(--spacing-lg);
      }

      .comparison-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-sm);
        font-weight: 500;
      }

      .comparison-item:last-child {
        margin-bottom: 0;
        padding-top: var(--spacing-sm);
        border-top: 1px solid rgba(45, 125, 50, 0.1);
      }

      .comparison-item .label {
        color: var(--gray);
      }

      .comparison-item .value {
        color: var(--charcoal);
        font-weight: 600;
      }

      .comparison-item .value.savings {
        color: var(--success);
      }

      /* Recommendations */
      .recommendations-intro {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--spacing-lg);
        padding: var(--spacing-lg);
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        border-radius: var(--radius-lg);
        color: var(--white);
      }

      .intro-content h3 {
        font-family: var(--font-display);
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: var(--spacing-sm);
      }

      .intro-content p {
        opacity: 0.9;
      }

      .potential-savings {
        text-align: center;
      }

      .savings-label {
        font-size: 0.875rem;
        opacity: 0.9;
        margin-bottom: var(--spacing-xs);
      }

      .savings-value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: var(--spacing-xs);
      }

      .savings-amount {
        font-size: 0.875rem;
        opacity: 0.9;
      }

      .recommendations-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-xl);
      }

      .recommendation-item {
        background: linear-gradient(
          135deg,
          var(--light-gray) 0%,
          var(--white) 100%
        );
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        border-left: 4px solid var(--primary-color);
        transition: var(--transition-normal);
      }

      .recommendation-item:hover {
        transform: translateX(5px);
        box-shadow: var(--shadow-sm);
      }

      .recommendation-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--spacing-sm);
      }

      .recommendation-title {
        font-weight: 600;
        color: var(--charcoal);
        margin-bottom: var(--spacing-xs);
      }

      .recommendation-description {
        color: var(--gray);
        line-height: 1.5;
        margin-bottom: var(--spacing-sm);
      }

      .recommendation-impact {
        font-weight: 600;
        color: var(--primary-color);
      }

      .loading-recommendations {
        text-align: center;
        padding: var(--spacing-xl);
        color: var(--gray);
      }

      /* Policy Options */
      .policy-tabs {
        display: flex;
        border-bottom: 2px solid var(--light-gray);
        margin-bottom: var(--spacing-lg);
      }

      .policy-tab {
        padding: var(--spacing-md) var(--spacing-lg);
        border: none;
        background: none;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: var(--transition-fast);
        font-weight: 600;
        color: var(--gray);
        position: relative;
      }

      .policy-tab.active {
        border-bottom-color: var(--primary-color);
        color: var(--primary-color);
      }

      .policy-tab:hover {
        color: var(--primary-light);
      }

      .policy-plan {
        background: linear-gradient(
          135deg,
          var(--light-gray) 0%,
          var(--white) 100%
        );
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        border: 1px solid rgba(45, 125, 50, 0.1);
      }

      .plan-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
        padding-bottom: var(--spacing-md);
        border-bottom: 1px solid rgba(45, 125, 50, 0.1);
      }

      .plan-header h3 {
        font-family: var(--font-display);
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--charcoal);
      }

      .plan-price {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-color);
      }

      .plan-features {
        list-style: none;
        margin-bottom: var(--spacing-lg);
      }

      .plan-features li {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-sm);
        font-weight: 500;
      }

      .plan-features li i.fa-check {
        color: var(--success);
      }

      .plan-features li i.fa-times {
        color: var(--error);
      }

      .select-plan {
        width: 100%;
        justify-content: center;
      }

      /* Modals */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
        z-index: 2000;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        visibility: hidden;
        transition: var(--transition-normal);
      }

      .modal.active {
        opacity: 1;
        visibility: visible;
      }

      .modal-content {
        background: var(--white);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xl);
        max-width: 90vw;
        max-height: 90vh;
        overflow-y: auto;
        transform: translateY(-20px);
        transition: var(--transition-normal);
        padding: var(--spacing-xl);
        min-width: 600px;
      }

      .modal.active .modal-content {
        transform: translateY(0);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
        padding-bottom: var(--spacing-md);
        border-bottom: 1px solid var(--light-gray);
      }

      .modal-header h2 {
        font-family: var(--font-display);
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--charcoal);
      }

      .close-modal {
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--gray);
        cursor: pointer;
        transition: var(--transition-fast);
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius-md);
      }

      .close-modal:hover {
        color: var(--error);
        background: rgba(244, 67, 54, 0.1);
      }

      .plan-summary-details {
        background: linear-gradient(
          135deg,
          var(--light-gray) 0%,
          var(--white) 100%
        );
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        border: 1px solid rgba(45, 125, 50, 0.1);
        margin-bottom: var(--spacing-lg);
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-sm);
        font-weight: 500;
      }

      .summary-item:last-child {
        margin-bottom: 0;
        padding-top: var(--spacing-sm);
        border-top: 1px solid rgba(45, 125, 50, 0.1);
      }

      .summary-item .label {
        color: var(--gray);
      }

      .summary-item .value {
        color: var(--charcoal);
        font-weight: 600;
      }

      .summary-item input {
        width: 120px;
        padding: var(--spacing-xs) var(--spacing-sm);
        border: 1px solid rgba(45, 125, 50, 0.2);
        border-radius: var(--radius-sm);
        text-align: center;
      }

      .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: var(--spacing-md);
      }

      /* Loading States */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        transition: var(--transition-normal);
      }

      .loading-overlay.hidden {
        opacity: 0;
        pointer-events: none;
      }

      .spinner {
        width: 60px;
        height: 60px;
        border: 4px solid var(--light-gray);
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        margin-top: var(--spacing-md);
        color: var(--charcoal);
        font-weight: 500;
      }

      /* Utility Classes */
      .hidden {
        display: none !important;
      }

      .text-center {
        text-align: center;
      }

      .mb-lg {
        margin-bottom: var(--spacing-lg);
      }

      .mt-lg {
        margin-top: var(--spacing-lg);
      }

      /* Responsive Design */
      @media (max-width: 1200px) {
        .insurance-grid {
          grid-template-columns: 1fr;
        }

        .results-container {
          grid-template-columns: 1fr;
        }

        .grid-inputs {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
      }

      @media (max-width: 768px) {
        body {
          padding-left: 0;
        }

        body.mobile {
          padding-left: 0;
        }

        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.mobile-open {
          transform: translateX(0);
        }

        .mobile-menu-toggle {
          display: block;
        }

        .container {
          padding: var(--spacing-md);
        }

        .header-actions {
          flex-direction: column;
          width: 100%;
          gap: var(--spacing-sm);
        }

        .stats-overview {
          grid-template-columns: 1fr;
        }

        .grid-inputs {
          grid-template-columns: 1fr;
        }

        .modal-content {
          min-width: auto;
          margin: var(--spacing-md);
          padding: var(--spacing-lg);
        }

        .recommendations-intro {
          flex-direction: column;
          gap: var(--spacing-md);
        }

        .policy-tabs {
          flex-direction: column;
          border-bottom: none;
        }

        .policy-tab {
          border-bottom: 1px solid var(--light-gray);
          border-left: 3px solid transparent;
        }

        .policy-tab.active {
          border-left-color: var(--primary-color);
          border-bottom-color: var(--light-gray);
        }
      }

      @media (max-width: 480px) {
        .sidebar {
          width: 100%;
        }

        .card-actions {
          flex-direction: column;
        }

        .form-actions {
          flex-direction: column;
        }
      }

      /* Animations */
      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .slide-in-up {
        animation: slideInUp 0.6s ease-out forwards;
      }

      .fade-in {
        animation: fadeIn 0.5s ease-out forwards;
      }

      /* Stagger animations for stats cards */
      .stat-card:nth-child(1) {
        animation-delay: 0.1s;
      }
      .stat-card:nth-child(2) {
        animation-delay: 0.2s;
      }
      .stat-card:nth-child(3) {
        animation-delay: 0.3s;
      }
      .stat-card:nth-child(4) {
        animation-delay: 0.4s;
      }
    </style>
  </head>

  <body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
      <div class="spinner"></div>
      <div class="loading-text">Calculating insurance premium...</div>
    </div>

    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="logo-icon">
            <i class="fas fa-seedling"></i>
          </div>
          <span class="logo-text">Talazo AgriFinance</span>
        </div>
        <button id="sidebar-toggle" class="sidebar-toggle">
          <i class="fas fa-bars"></i>
        </button>
      </div>

      <div class="sidebar-content">
        <div class="user-profile">
          <div class="profile-avatar">
            <i class="fas fa-user-circle"></i>
          </div>
          <div class="profile-info">
            <div class="profile-name">Financial Officer</div>
            <div class="profile-role">AgriFinance Division</div>
          </div>
        </div>

        <ul class="nav-menu">
          <li class="nav-item">
            <a href="/dashboard" class="nav-link">
              <i class="fas fa-tachometer-alt"></i>
              <span class="nav-text">Dashboard</span>
              <div class="nav-indicator"></div>
            </a>
          </li>
          <li class="nav-item">
            <a href="/farmers" class="nav-link">
              <i class="fas fa-users"></i>
              <span class="nav-text">Farmers</span>
              <div class="nav-badge">156</div>
            </a>
          </li>
          <li class="nav-item">
            <a href="/loans" class="nav-link">
              <i class="fas fa-hand-holding-usd"></i>
              <span class="nav-text">Loans</span>
              <div class="nav-badge">23</div>
            </a>
          </li>
          <li class="nav-item active">
            <a href="/insurance" class="nav-link">
              <i class="fas fa-shield-alt"></i>
              <span class="nav-text">Insurance</span>
              <div class="nav-badge">89</div>
              <div class="nav-indicator"></div>
            </a>
          </li>
          <li class="nav-item">
            <a href="/soil_analysis" class="nav-link">
              <i class="fas fa-vial"></i>
              <span class="nav-text">Soil Analysis</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="/ai_recommendations" class="nav-link">
              <i class="fas fa-brain"></i>
              <span class="nav-text">AI Recommendations</span>
            </a>
          </li>

          <li class="nav-divider"></li>

          <li class="nav-section">
            <span class="nav-section-title">Analytics</span>
          </li>
          <li class="nav-item">
            <a href="/reports" class="nav-link">
              <i class="fas fa-chart-bar"></i>
              <span class="nav-text">Reports</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="/trends" class="nav-link">
              <i class="fas fa-chart-line"></i>
              <span class="nav-text">Market Trends</span>
            </a>
          </li>

          <li class="nav-divider"></li>

          <li class="nav-section">
            <span class="nav-section-title">System</span>
          </li>
          <li class="nav-item">
            <a href="/settings" class="nav-link">
              <i class="fas fa-cog"></i>
              <span class="nav-text">Settings</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="/help" class="nav-link">
              <i class="fas fa-question-circle"></i>
              <span class="nav-text">Help & Support</span>
            </a>
          </li>
        </ul>

        <div class="sidebar-footer">
          <div class="quick-actions">
            <button class="quick-action" title="Calculate Premium">
              <i class="fas fa-calculator"></i>
            </button>
            <button class="quick-action" title="Generate Report">
              <i class="fas fa-file-alt"></i>
            </button>
            <button class="quick-action" title="Send Quote">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
          <button class="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            <span class="nav-text">Logout</span>
          </button>
        </div>
      </div>
    </nav>

    <!-- Mobile Overlay -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="header-left">
          <button id="mobile-menu-toggle" class="mobile-menu-toggle">
            <i class="fas fa-bars"></i>
          </button>
          <div class="page-header">
            <div class="breadcrumb">
              <i class="fas fa-shield-alt"></i>
              <span>Insurance</span>
              <i class="fas fa-chevron-right"></i>
              <span>Premium Calculator</span>
            </div>
            <h1 class="page-title">Insurance Management</h1>
            <p class="page-subtitle">
              Calculate premiums based on soil health metrics and risk assessment
            </p>
          </div>
        </div>
        <div class="header-actions">
          <select id="farmer-selector" class="farmer-selector">
            <option value="">Select Farmer</option>
            <option value="1">John Moyo (Harare)</option>
            <option value="2">Mary Ncube (Bulawayo)</option>
            <option value="3">Robert Dube (Mutare)</option>
          </select>
          <button id="refresh-data" class="btn btn-secondary">
            <i class="fas fa-sync"></i> Refresh
          </button>
        </div>
      </div>
    </header>

    <div class="container">
      <!-- Stats Overview -->
      <div class="stats-overview">
        <div class="stat-card slide-in-up">
          <div class="stat-header">
            <div>
              <div class="stat-value">89</div>
              <div class="stat-label">Active Policies</div>
              <div class="stat-trend trend-up">
                <i class="fas fa-arrow-up"></i>
                <span>+12.5% this month</span>
              </div>
            </div>
            <div class="stat-icon">
              <i class="fas fa-shield-alt"></i>
            </div>
          </div>
        </div>

        <div class="stat-card slide-in-up">
          <div class="stat-header">
            <div>
              <div class="stat-value">$145</div>
              <div class="stat-label">Avg Premium/ha</div>
              <div class="stat-trend trend-down">
                <i class="fas fa-arrow-down"></i>
                <span>-8.3% due to better soil health</span>
              </div>
            </div>
            <div class="stat-icon">
              <i class="fas fa-dollar-sign"></i>
            </div>
          </div>
        </div>

        <div class="stat-card slide-in-up">
          <div class="stat-header">
            <div>
              <div class="stat-value">97%</div>
              <div class="stat-label">Customer Satisfaction</div>
              <div class="stat-trend trend-up">
                <i class="fas fa-arrow-up"></i>
                <span>Excellent rating</span>
              </div>
            </div>
            <div class="stat-icon">
              <i class="fas fa-thumbs-up"></i>
            </div>
          </div>
        </div>

        <div class="stat-card slide-in-up">
          <div class="stat-header">
            <div>
              <div class="stat-value">2,847</div>
              <div class="stat-label">Hectares Covered</div>
              <div class="stat-trend trend-up">
                <i class="fas fa-arrow-up"></i>
                <span>Growing coverage</span>
              </div>
            </div>
            <div class="stat-icon">
              <i class="fas fa-seedling"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Insurance Grid -->
      <div class="insurance-grid">
        <!-- Main Content -->
        <div class="insurance-main">
          <!-- Soil Metrics Input -->
          <div class="card fade-in">
            <div class="card-title">
              <h2>
                <i class="fas fa-seedling"></i>
                <span>Soil Health Metrics</span>
              </h2>
              <div class="card-actions">
                <button id="load-sample-data" class="btn btn-secondary">
                  <i class="fas fa-database"></i> Load Sample Data
                </button>
                <button id="clear-form" class="btn btn-secondary">
                  <i class="fas fa-eraser"></i> Clear
                </button>
              </div>
            </div>

            <form id="soil-metrics-form">
              <div class="grid-inputs">
                <div class="form-group">
                  <label for="ph_level">pH Level</label>
                  <input
                    type="number"
                    id="ph_level"
                    name="ph_level"
                    step="0.1"
                    min="3.0"
                    max="10.0"
                    placeholder="6.0-7.0"
                  />
                  <div class="param-range">Ideal: 6.0-7.0</div>
                </div>

                <div class="form-group">
                  <label for="nitrogen_level">Nitrogen (mg/kg)</label>
                  <input
                    type="number"
                    id="nitrogen_level"
                    name="nitrogen_level"
                    step="0.1"
                    min="0"
                    max="100"
                    placeholder="20.0-40.0"
                  />
                  <div class="param-range">Ideal: 20.0-40.0</div>
                </div>

                <div class="form-group">
                  <label for="phosphorus_level">Phosphorus (mg/kg)</label>
                  <input
                    type="number"
                    id="phosphorus_level"
                    name="phosphorus_level"
                    step="0.1"
                    min="0"
                    max="100"
                    placeholder="15.0-30.0"
                  />
                  <div class="param-range">Ideal: 15.0-30.0</div>
                </div>

                <div class="form-group">
                  <label for="potassium_level">Potassium (mg/kg)</label>
                  <input
                    type="number"
                    id="potassium_level"
                    name="potassium_level"
                    step="0.1"
                    min="0"
                    max="500"
                    placeholder="150.0-250.0"
                  />
                  <div class="param-range">Ideal: 150.0-250.0</div>
                </div>

                <div class="form-group">
                  <label for="organic_matter">Organic Matter (%)</label>
                  <input
                    type="number"
                    id="organic_matter"
                    name="organic_matter"
                    step="0.1"
                    min="0"
                    max="10"
                    placeholder="3.0-5.0"
                  />
                  <div class="param-range">Ideal: 3.0-5.0</div>
                </div>

                <div class="form-group">
                  <label for="cation_exchange_capacity">Cation Exchange Capacity (cmol/kg)</label>
                  <input
                    type="number"
                    id="cation_exchange_capacity"
                    name="cation_exchange_capacity"
                    step="0.1"
                    min="0"
                    max="50"
                    placeholder="10.0-20.0"
                  />
                  <div class="param-range">Ideal: 10.0-20.0</div>
                </div>

                <div class="form-group">
                  <label for="moisture_content">Moisture Content (%)</label>
                  <input
                    type="number"
                    id="moisture_content"
                    name="moisture_content"
                    step="0.1"
                    min="0"
                    max="100"
                    placeholder="20.0-30.0"
                  />
                  <div class="param-range">Ideal: 20.0-30.0</div>
                </div>

                <div class="form-group">
                  <label for="region">Region</label>
                  <select id="region" name="region">
                    <option value="">-- Select Region --</option>
                    <option value="mashonaland_central">Mashonaland Central</option>
                    <option value="mashonaland_east">Mashonaland East</option>
                    <option value="mashonaland_west">Mashonaland West</option>
                    <option value="manicaland">Manicaland</option>
                    <option value="masvingo">Masvingo</option>
                    <option value="matabeleland_north">Matabeleland North</option>
                    <option value="matabeleland_south">Matabeleland South</option>
                    <option value="midlands">Midlands</option>
                  </select>
                </div>
              </div>

              <div class="form-actions">
                <button type="submit" id="calculate-premium" class="btn btn-primary">
                  <i class="fas fa-calculator"></i> Calculate Premium
                </button>
              </div>
            </form>
          </div>

          <!-- Premium Results -->
          <div class="card fade-in">
            <div class="card-title">
              <h2>
                <i class="fas fa-shield-alt"></i>
                <span>Insurance Premium Results</span>
              </h2>
              <div class="card-actions">
                <button id="save-results" class="btn btn-secondary">
                  <i class="fas fa-save"></i> Save Results
                </button>
                <button id="print-results" class="btn btn-secondary">
                  <i class="fas fa-print"></i> Print
                </button>
              </div>
            </div>

            <div class="results-container">
              <div class="soil-health-gauge">
                <h3>Soil Health Index</h3>
                <div id="soil-health-gauge" class="chart-container"></div>
                <div class="gauge-value">
                  <span id="soil-health-score">--</span>
                  <span class="unit">/100</span>
                </div>
              </div>

              <div class="premium-details">
                <h3>Premium Details</h3>
                <div class="premium-amount">
                  <div class="amount">
                    $<span id="premium-amount">--</span>
                    <span class="unit">/hectare</span>
                  </div>
                  <div class="risk-level">
                    Risk Level: <span id="risk-level">--</span>
                  </div>
                </div>

                <div class="coverage-details">
                  <div class="coverage-item">
                    <span class="label">Base Coverage</span>
                    <span class="value">$<span id="base-coverage">1,000</span>/ha</span>
                  </div>
                  <div class="coverage-item">
                    <span class="label">Drought Protection</span>
                    <span class="value" id="drought-protection">--</span>
                  </div>
                  <div class="coverage-item">
                    <span class="label">Pest & Disease</span>
                    <span class="value" id="pest-disease">--</span>
                  </div>
                  <div class="coverage-item">
                    <span class="label">Policy Term</span>
                    <span class="value">12 months</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="premium-factors">
              <h3>Premium Factors Analysis</h3>
              <div id="factors-chart" class="chart-container"></div>
            </div>

            <div class="comparison-container">
              <h3>Premium Comparison</h3>
              <div class="comparison-item">
                <span class="label">Current Premium</span>
                <span class="value">$<span id="current-premium">--</span>/ha</span>
              </div>
              <div class="comparison-item">
                <span class="label">Average Market Rate</span>
                <span class="value">$175/ha</span>
              </div>
              <div class="comparison-item">
                <span class="label">Potential Savings</span>
                <span class="value savings">$<span id="potential-savings">--</span>/ha</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar Content -->
        <div class="insurance-sidebar">
          <!-- AI Recommendations -->
          <div class="card fade-in">
            <div class="card-title">
              <h2>
                <i class="fas fa-brain"></i>
                <span>AI Recommendations</span>
              </h2>
              <div class="card-actions">
                <button id="generate-more-recommendations" class="btn btn-secondary">
                  <i class="fas fa-robot"></i> Generate More
                </button>
              </div>
            </div>

            <div class="recommendations-intro">
              <div class="intro-content">
                <h3>Improve Your Soil Health</h3>
                <p>Personalized recommendations to reduce premium costs</p>
              </div>
              <div class="potential-savings">
                <div class="savings-label">Potential Premium Reduction</div>
                <div class="savings-value">
                  <span id="potential-reduction-percentage">--</span>%
                </div>
                <div class="savings-amount">
                  Save $<span id="potential-reduction-amount">--</span>/ha
                </div>
              </div>
            </div>

            <div id="recommendations-list" class="recommendations-list">
              <div class="loading-recommendations">
                <div class="spinner"></div>
                <p>Enter soil metrics to generate personalized recommendations</p>
              </div>
            </div>

            <div class="intervention-impact">
              <h3>Intervention Impact</h3>
              <div id="impact-chart" class="chart-container"></div>
            </div>
          </div>

          <!-- Policy Options -->
          <div class="card fade-in">
            <div class="card-title">
              <h2>
                <i class="fas fa-file-contract"></i>
                <span>Policy Options</span>
              </h2>
            </div>

            <div class="policy-tabs">
              <button class="policy-tab active" data-plan="basic">Basic Plan</button>
              <button class="policy-tab" data-plan="standard">Standard Plan</button>
              <button class="policy-tab" data-plan="premium">Premium Plan</button>
            </div>

            <div class="policy-content">
              <div class="policy-plan" id="basic-plan">
                <div class="plan-header">
                  <h3>Basic Protection Plan</h3>
                  <div class="plan-price">$<span id="basic-plan-price">--</span>/ha</div>
                </div>
                <ul class="plan-features">
                  <li><i class="fas fa-check"></i> Drought coverage (partial)</li>
                  <li><i class="fas fa-check"></i> Fire damage</li>
                  <li><i class="fas fa-check"></i> Basic flood protection</li>
                  <li><i class="fas fa-times"></i> Pest & disease coverage</li>
                  <li><i class="fas fa-times"></i> Hail damage</li>
                  <li><i class="fas fa-times"></i> Price protection</li>
                </ul>
                <button class="btn btn-primary select-plan" data-plan="basic">
                  Select Plan
                </button>
              </div>

              <div class="policy-plan hidden" id="standard-plan">
                <div class="plan-header">
                  <h3>Standard Protection Plan</h3>
                  <div class="plan-price">$<span id="standard-plan-price">--</span>/ha</div>
                </div>
                <ul class="plan-features">
                  <li><i class="fas fa-check"></i> Full drought coverage</li>
                  <li><i class="fas fa-check"></i> Fire damage</li>
                  <li><i class="fas fa-check"></i> Enhanced flood protection</li>
                  <li><i class="fas fa-check"></i> Basic pest & disease coverage</li>
                  <li><i class="fas fa-check"></i> Hail damage</li>
                  <li><i class="fas fa-times"></i> Price protection</li>
                </ul>
                <button class="btn btn-primary select-plan" data-plan="standard">
                  Select Plan
                </button>
              </div>

              <div class="policy-plan hidden" id="premium-plan">
                <div class="plan-header">
                  <h3>Premium Protection Plan</h3>
                  <div class="plan-price">$<span id="premium-plan-price">--</span>/ha</div>
                </div>
                <ul class="plan-features">
                  <li><i class="fas fa-check"></i> Complete drought coverage</li>
                  <li><i class="fas fa-check"></i> Fire damage</li>
                  <li><i class="fas fa-check"></i> Full flood protection</li>
                  <li><i class="fas fa-check"></i> Comprehensive pest & disease</li>
                  <li><i class="fas fa-check"></i> Hail & storm damage</li>
                  <li><i class="fas fa-check"></i> Price protection</li>
                </ul>
                <button class="btn btn-primary select-plan" data-plan="premium">
                  Select Plan
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Plan Selection Modal -->
    <div id="plan-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Confirm Your Policy Selection</h2>
          <button class="close-modal">&times;</button>
        </div>
        
        <div class="plan-summary">
          <h3 id="selected-plan-name">Basic Protection Plan</h3>
          <div class="plan-summary-details">
            <div class="summary-item">
              <span class="label">Premium Amount:</span>
              <span class="value">$<span id="modal-premium-amount">--</span>/ha</span>
            </div>
            <div class="summary-item">
              <span class="label">Coverage Area:</span>
              <span class="value">
                <input type="number" id="coverage-area" min="0.5" step="0.5" value="1" /> hectares
              </span>
            </div>
            <div class="summary-item">
              <span class="label">Total Premium:</span>
              <span class="value">$<span id="total-premium">--</span></span>
            </div>
            <div class="summary-item">
              <span class="label">Policy Term:</span>
              <span class="value">12 months</span>
            </div>
            <div class="summary-item">
              <span class="label">Start Date:</span>
              <span class="value">
                <input type="date" id="policy-start-date" />
              </span>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button id="confirm-plan" class="btn btn-primary">
            <i class="fas fa-check"></i> Confirm Selection
          </button>
          <button class="btn btn-secondary close-modal">Cancel</button>
        </div>
      </div>
    </div>

    <!-- JavaScript -->
    <script>
      // Insurance Configuration and State Management
      const InsuranceConfig = {
        refreshInterval: 30000,
        animationDelay: 100,
      };

      let insuranceState = {
        currentFarmer: "",
        soilHealthScore: 0,
        premiumAmount: 0,
        riskLevel: "Medium",
        selectedPlan: "basic",
        calculationResults: null
      };

      // Initialize Application
      document.addEventListener('DOMContentLoaded', function() {
        initializeInsurancePage();
        setupEventListeners();
        setupSidebar();
        initializeCharts();
        initializeAnimations();
        setDefaultDate();
      });

      function initializeInsurancePage() {
        console.log('🌱 Talazo AgriFinance - Insurance Management Initialized');
      }

      function setupEventListeners() {
        // Sidebar toggle
        document.getElementById('sidebar-toggle').addEventListener('click', toggleSidebar);
        document.getElementById('mobile-menu-toggle').addEventListener('click', toggleMobileSidebar);
        document.getElementById('sidebar-overlay').addEventListener('click', closeMobileSidebar);

        // Navigation links
        document.querySelectorAll('.nav-link').forEach(link => {
          link.addEventListener('click', function(e) {
            document.querySelectorAll('.nav-item').forEach(item => {
              item.classList.remove('active');
            });
            this.closest('.nav-item').classList.add('active');
            if (window.innerWidth <= 768) {
              closeMobileSidebar();
            }
          });
        });

        // Form submissions
        document.getElementById('soil-metrics-form').addEventListener('submit', handlePremiumCalculation);

        // Sample data and clear buttons
        document.getElementById('load-sample-data').addEventListener('click', loadSampleData);
        document.getElementById('clear-form').addEventListener('click', clearForm);

        // Results actions
        document.getElementById('save-results').addEventListener('click', saveResults);
        document.getElementById('print-results').addEventListener('click', printResults);

        // Policy tabs
        document.querySelectorAll('.policy-tab').forEach(tab => {
          tab.addEventListener('click', function() {
            switchPolicyTab(this.dataset.plan);
          });
        });

        // Plan selection
        document.querySelectorAll('.select-plan').forEach(button => {
          button.addEventListener('click', function() {
            selectPlan(this.dataset.plan);
          });
        });

        // Modal controls
        document.querySelectorAll('.close-modal').forEach(button => {
          button.addEventListener('click', closeModal);
        });

        document.getElementById('confirm-plan').addEventListener('click', confirmPlanSelection);
        document.getElementById('coverage-area').addEventListener('input', updateTotalPremium);

        // Farmer selector
        document.getElementById('farmer-selector').addEventListener('change', function(e) {
          insuranceState.currentFarmer = e.target.value;
          if (e.target.value) {
            loadFarmerData(e.target.value);
          }
        });

        // Refresh button
        document.getElementById('refresh-data').addEventListener('click', refreshData);

        // Window resize
        window.addEventListener('resize', handleResize);
      }

      function setupSidebar() {
        // Restore sidebar state
        const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
        if (isCollapsed) {
          document.getElementById('sidebar').classList.add('collapsed');
          document.body.classList.add('sidebar-collapsed');
        }
        handleResize();
      }

      function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const body = document.body;
        
        sidebar.classList.toggle('collapsed');
        body.classList.toggle('sidebar-collapsed');
        
        localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
      }

      function toggleMobileSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        
        sidebar.classList.toggle('mobile-open');
        overlay.classList.toggle('active');
        document.body.style.overflow = sidebar.classList.contains('mobile-open') ? 'hidden' : '';
      }

      function closeMobileSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        
        sidebar.classList.remove('mobile-open');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
      }

      function handleResize() {
        const sidebar = document.getElementById('sidebar');
        const body = document.body;
        
        if (window.innerWidth <= 768) {
          body.classList.add('mobile');
          closeMobileSidebar();
        } else {
          body.classList.remove('mobile');
          sidebar.classList.remove('mobile-open');
          document.getElementById('sidebar-overlay').classList.remove('active');
          document.body.style.overflow = '';
        }

        // Resize charts
        setTimeout(() => {
          if (typeof Plotly !== 'undefined') {
            Plotly.Plots.resize('soil-health-gauge');
            Plotly.Plots.resize('factors-chart');
            Plotly.Plots.resize('impact-chart');
          }
        }, 100);
      }

      function initializeCharts() {
        createSoilHealthGauge();
        createFactorsChart();
        createImpactChart();
      }

      function createSoilHealthGauge() {
        const gaugeData = [{
          type: "indicator",
          mode: "gauge+number",
          value: insuranceState.soilHealthScore,
          domain: { x: [0, 1], y: [0, 1] },
          gauge: {
            axis: { range: [null, 100] },
            bar: { color: "#2d7d32" },
            steps: [
              { range: [0, 40], color: "#ffcdd2" },
              { range: [40, 60], color: "#fff3e0" },
              { range: [60, 80], color: "#e8f5e9" },
              { range: [80, 100], color: "#c8e6c9" }
            ],
            threshold: {
              line: { color: "#1b5e20", width: 4 },
              thickness: 0.75,
              value: 85
            }
          },
          number: { suffix: "/100", font: { size: 20 } }
        }];

        const layout = {
          width: 300,
          height: 250,
          margin: { t: 20, b: 20, l: 20, r: 20 },
          paper_bgcolor: "rgba(0,0,0,0)",
          plot_bgcolor: "rgba(0,0,0,0)",
          font: {
            family: "Inter, sans-serif",
            size: 14,
            color: "#212121"
          }
        };

        const config = {
          displayModeBar: false,
          responsive: true
        };

        Plotly.newPlot('soil-health-gauge', gaugeData, layout, config);
      }

      function createFactorsChart() {
        const factors = ['pH Level', 'Nutrients', 'Organic Matter', 'Moisture', 'Regional Risk'];
        const impacts = [85, 78, 92, 67, 73];

        const trace = {
          x: factors,
          y: impacts,
          type: 'bar',
          marker: {
            color: impacts.map(value => 
              value >= 80 ? '#4caf50' : 
              value >= 60 ? '#ff9800' : '#f44336'
            )
          }
        };

        const layout = {
          title: {
            text: 'Soil Health Factor Scores',
            font: { family: 'Inter, sans-serif', size: 16 }
          },
          xaxis: { title: 'Factors' },
          yaxis: { title: 'Score', range: [0, 100] },
          margin: { t: 50, b: 80, l: 40, r: 20 },
          paper_bgcolor: "rgba(0,0,0,0)",
          plot_bgcolor: "rgba(0,0,0,0)",
          font: { family: 'Inter, sans-serif' }
        };

        const config = {
          displayModeBar: false,
          responsive: true
        };

        Plotly.newPlot('factors-chart', [trace], layout, config);
      }

      function createImpactChart() {
        const interventions = ['Current', 'Improve pH', 'Add Organic Matter', 'Optimize Moisture'];
        const premiumReductions = [0, 15, 25, 12];

        const trace = {
          x: interventions,
          y: premiumReductions,
          type: 'bar',
          marker: { color: '#2d7d32' }
        };

        const layout = {
          title: {
            text: 'Premium Reduction Potential',
            font: { family: 'Inter, sans-serif', size: 14 }
          },
          xaxis: { title: 'Interventions' },
          yaxis: { title: 'Premium Reduction (%)' },
          margin: { t: 50, b: 80, l: 40, r: 20 },
          paper_bgcolor: "rgba(0,0,0,0)",
          plot_bgcolor: "rgba(0,0,0,0)",
          font: { family: 'Inter, sans-serif', size: 12 }
        };

        const config = {
          displayModeBar: false,
          responsive: true
        };

        Plotly.newPlot('impact-chart', [trace], layout, config);
      }

      function handlePremiumCalculation(e) {
        e.preventDefault();
        
        showLoadingOverlay();
        
        // Get form data
        const formData = new FormData(e.target);
        const soilData = {};
        
        for (let [key, value] of formData.entries()) {
          soilData[key] = parseFloat(value) || value;
        }

        // Simulate API call
        setTimeout(() => {
          const results = calculatePremium(soilData);
          displayResults(results);
          generateRecommendations(soilData, results);
          updatePolicyPrices(results.premiumAmount);
          hideLoadingOverlay();
          showToast('Premium calculated successfully!', 'success');
        }, 2000);
      }

      function calculatePremium(soilData) {
        // Simplified premium calculation logic
        let baseScore = 50;
        let premiumMultiplier = 1.0;

        // pH Level scoring
        if (soilData.ph_level >= 6.0 && soilData.ph_level <= 7.0) {
          baseScore += 10;
          premiumMultiplier *= 0.9;
        } else if (soilData.ph_level < 5.5 || soilData.ph_level > 8.0) {
          baseScore -= 15;
          premiumMultiplier *= 1.2;
        }

        // Nutrient scoring
        if (soilData.nitrogen_level >= 20 && soilData.nitrogen_level <= 40) {
          baseScore += 8;
          premiumMultiplier *= 0.95;
        }
        
        if (soilData.phosphorus_level >= 15 && soilData.phosphorus_level <= 30) {
          baseScore += 8;
          premiumMultiplier *= 0.95;
        }
        
        if (soilData.potassium_level >= 150 && soilData.potassium_level <= 250) {
          baseScore += 8;
          premiumMultiplier *= 0.95;
        }

        // Organic matter and moisture
        if (soilData.organic_matter >= 3.0) {
          baseScore += 10;
          premiumMultiplier *= 0.85;
        }
        
        if (soilData.moisture_content >= 20 && soilData.moisture_content <= 30) {
          baseScore += 6;
          premiumMultiplier *= 0.92;
        }

        // Regional adjustments
        const regionalMultipliers = {
          'mashonaland_central': 0.95,
          'mashonaland_east': 1.0,
          'mashonaland_west': 1.05,
          'manicaland': 0.9,
          'masvingo': 1.1,
          'matabeleland_north': 1.15,
          'matabeleland_south': 1.2,
          'midlands': 1.0
        };
        
        if (soilData.region && regionalMultipliers[soilData.region]) {
          premiumMultiplier *= regionalMultipliers[soilData.region];
        }

        // Calculate final values
        const soilHealthScore = Math.min(Math.max(baseScore, 0), 100);
        const basePremium = 175; // Base premium per hectare
        const premiumAmount = Math.round(basePremium * premiumMultiplier);
        
        let riskLevel = 'Medium';
        if (soilHealthScore >= 80) riskLevel = 'Low';
        else if (soilHealthScore >= 60) riskLevel = 'Medium';
        else riskLevel = 'High';

        return {
          soilHealthScore,
          premiumAmount,
          riskLevel,
          potentialSavings: Math.max(0, basePremium - premiumAmount),
          droughtProtection: soilHealthScore >= 70 ? 'Full Coverage' : 'Partial Coverage',
          pestDisease: soilHealthScore >= 80 ? 'Comprehensive' : 'Basic'
        };
      }

      function displayResults(results) {
        insuranceState.calculationResults = results;
        insuranceState.soilHealthScore = results.soilHealthScore;
        insuranceState.premiumAmount = results.premiumAmount;
        insuranceState.riskLevel = results.riskLevel;

        // Update UI elements
        document.getElementById('soil-health-score').textContent = results.soilHealthScore;
        document.getElementById('premium-amount').textContent = results.premiumAmount;
        document.getElementById('risk-level').textContent = results.riskLevel;
        document.getElementById('current-premium').textContent = results.premiumAmount;
        document.getElementById('potential-savings').textContent = results.potentialSavings;
        document.getElementById('drought-protection').textContent = results.droughtProtection;
        document.getElementById('pest-disease').textContent = results.pestDisease;

        // Update gauge
        const gaugeData = [{
          type: "indicator",
          mode: "gauge+number",
          value: results.soilHealthScore,
          domain: { x: [0, 1], y: [0, 1] },
          gauge: {
            axis: { range: [null, 100] },
            bar: { color: "#2d7d32" },
            steps: [
              { range: [0, 40], color: "#ffcdd2" },
              { range: [40, 60], color: "#fff3e0" },
              { range: [60, 80], color: "#e8f5e9" },
              { range: [80, 100], color: "#c8e6c9" }
            ],
            threshold: {
              line: { color: "#1b5e20", width: 4 },
              thickness: 0.75,
              value: 85
            }
          },
          number: { suffix: "/100", font: { size: 20 } }
        }];

        const layout = {
          width: 300,
          height: 250,
          margin: { t: 20, b: 20, l: 20, r: 20 },
          paper_bgcolor: "rgba(0,0,0,0)",
          plot_bgcolor: "rgba(0,0,0,0)",
          font: {
            family: "Inter, sans-serif",
            size: 14,
            color: "#212121"
          }
        };

        Plotly.react('soil-health-gauge', gaugeData, layout);
      }

      function generateRecommendations(soilData, results) {
        const recommendationsContainer = document.getElementById('recommendations-list');
        const recommendations = [];

        // Generate recommendations based on soil data
        if (soilData.ph_level < 6.0 || soilData.ph_level > 7.0) {
          recommendations.push({
            title: 'Optimize pH Levels',
            description: 'Adjust soil pH to the optimal range of 6.0-7.0 through lime application or organic amendments.',
            impact: 'Premium reduction: $15-25/ha'
          });
        }

        if (soilData.organic_matter < 3.0) {
          recommendations.push({
            title: 'Increase Organic Matter',
            description: 'Add compost, manure, or cover crops to boost organic matter content above 3%.',
            impact: 'Premium reduction: $20-35/ha'
          });
        }

        if (soilData.moisture_content < 20) {
          recommendations.push({
            title: 'Improve Water Management',
            description: 'Implement drip irrigation or water conservation techniques to maintain optimal moisture.',
            impact: 'Premium reduction: $10-18/ha'
          });
        }

        // Update potential savings
        const totalReduction = Math.min(30, recommendations.length * 12);
        document.getElementById('potential-reduction-percentage').textContent = totalReduction;
        document.getElementById('potential-reduction-amount').textContent = Math.round(results.premiumAmount * totalReduction / 100);

        // Display recommendations
        if (recommendations.length > 0) {
          recommendationsContainer.innerHTML = recommendations.map(rec => `
            <div class="recommendation-item">
              <div class="recommendation-title">${rec.title}</div>
              <div class="recommendation-description">${rec.description}</div>
              <div class="recommendation-impact">${rec.impact}</div>
            </div>
          `).join('');
        } else {
          recommendationsContainer.innerHTML = `
            <div class="recommendation-item">
              <div class="recommendation-title">Excellent Soil Health!</div>
              <div class="recommendation-description">Your soil parameters are already optimized. Continue current management practices.</div>
              <div class="recommendation-impact">Maintain low premium rates</div>
            </div>
          `;
        }
      }

      function updatePolicyPrices(basePremium) {
        document.getElementById('basic-plan-price').textContent = basePremium;
        document.getElementById('standard-plan-price').textContent = Math.round(basePremium * 1.3);
        document.getElementById('premium-plan-price').textContent = Math.round(basePremium * 1.6);
      }

      function loadSampleData() {
        document.getElementById('ph_level').value = '6.8';
        document.getElementById('nitrogen_level').value = '32.5';
        document.getElementById('phosphorus_level').value = '22.0';
        document.getElementById('potassium_level').value = '185.0';
        document.getElementById('organic_matter').value = '3.8';
        document.getElementById('cation_exchange_capacity').value = '15.2';
        document.getElementById('moisture_content').value = '24.5';
        document.getElementById('region').value = 'mashonaland_east';
        
        showToast('Sample data loaded successfully!', 'success');
      }

      function clearForm() {
        document.getElementById('soil-metrics-form').reset();
        showToast('Form cleared successfully!', 'info');
      }

      function loadFarmerData(farmerId) {
        showLoadingOverlay();
        
        // Simulate loading farmer data
        setTimeout(() => {
          loadSampleData(); // Load sample data for demo
          hideLoadingOverlay();
          showToast(`Loaded data for farmer ${farmerId}`, 'success');
        }, 1000);
      }

      function switchPolicyTab(plan) {
        // Update tab buttons
        document.querySelectorAll('.policy-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        document.querySelector(`[data-plan="${plan}"]`).classList.add('active');

        // Show/hide plan content
        document.querySelectorAll('.policy-plan').forEach(planDiv => {
          planDiv.classList.add('hidden');
        });
        document.getElementById(`${plan}-plan`).classList.remove('hidden');
      }

      function selectPlan(plan) {
        insuranceState.selectedPlan = plan;
        
        const planNames = {
          basic: 'Basic Protection Plan',
          standard: 'Standard Protection Plan',
          premium: 'Premium Protection Plan'
        };
        
        const premiumAmount = document.getElementById(`${plan}-plan-price`).textContent;
        
        document.getElementById('selected-plan-name').textContent = planNames[plan];
        document.getElementById('modal-premium-amount').textContent = premiumAmount;
        
        updateTotalPremium();
        document.getElementById('plan-modal').classList.add('active');
      }

      function updateTotalPremium() {
        const premiumPerHa = parseFloat(document.getElementById('modal-premium-amount').textContent) || 0;
        const area = parseFloat(document.getElementById('coverage-area').value) || 1;
        const total = Math.round(premiumPerHa * area);
        
        document.getElementById('total-premium').textContent = total;
      }

      function confirmPlanSelection() {
        const plan = insuranceState.selectedPlan;
        const area = document.getElementById('coverage-area').value;
        const startDate = document.getElementById('policy-start-date').value;
        
        if (!startDate) {
          showToast('Please select a policy start date', 'warning');
          return;
        }
        
        showLoadingOverlay();
        
        setTimeout(() => {
          hideLoadingOverlay();
          closeModal();
          showToast(`${plan.charAt(0).toUpperCase() + plan.slice(1)} plan selected successfully!`, 'success');
        }, 1500);
      }

      function closeModal() {
        document.getElementById('plan-modal').classList.remove('active');
      }

      function setDefaultDate() {
        const today = new Date();
        const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
        document.getElementById('policy-start-date').value = nextWeek.toISOString().split('T')[0];
      }

      function saveResults() {
        if (!insuranceState.calculationResults) {
          showToast('No results to save. Please calculate premium first.', 'warning');
          return;